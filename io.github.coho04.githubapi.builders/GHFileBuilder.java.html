<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GHFileBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">io.github.coho04:githubapi</a> &gt; <a href="index.source.html" class="el_package">io.github.coho04.githubapi.builders</a> &gt; <span class="el_source">GHFileBuilder.java</span></div><h1>GHFileBuilder.java</h1><pre class="source lang-java linenums">package io.github.coho04.githubapi.builders;

import io.github.coho04.githubapi.Github;
import io.github.coho04.githubapi.bases.GHBase;
import io.github.coho04.githubapi.entities.repositories.GHBranch;
import io.github.coho04.githubapi.entities.repositories.GHRepository;
import org.json.JSONObject;

import java.util.Base64;

/**
 * GHFileBuilder is a class that extends GHBase. It represents a builder for creating and committing files to a GitHub repository.
 * It contains several properties such as branch, path, content, message, and repository.
 * These properties are initialized through the constructor and can be set using the provided setter methods.
 *
 * @author Coho04
 * @version 1.0
 * @since 2024-1.2
 */
<span class="fc" id="L20">public class GHFileBuilder extends GHBase {</span>

    private GHBranch branch;
    private String path;
    private String content;
    private String message;
    private final GHRepository repository;
    private final Github github;
    private String sha;

    /**
     * Constructs a new GHFileBuilder object for a given repository.
     *
     * @param repository a GHRepository object representing the repository to which the file will be committed.
     */
<span class="fc" id="L35">    public GHFileBuilder(GHRepository repository, Github github) {</span>
<span class="fc" id="L36">        this.repository = repository;</span>
<span class="fc" id="L37">        this.github = github;</span>
<span class="fc" id="L38">    }</span>

    /**
     * Constructs a new GHFileBuilder object for a given repository and branch.
     *
     * @param repository a GHRepository object representing the repository to which the file will be committed.
     * @param branch a GHBranch object representing the branch to which the file will be committed.
     */
<span class="fc" id="L46">    public GHFileBuilder(GHRepository repository, GHBranch branch, Github github) {</span>
<span class="fc" id="L47">        this.branch = branch;</span>
<span class="fc" id="L48">        this.github = github;</span>
<span class="fc" id="L49">        this.repository = repository;</span>
<span class="fc" id="L50">    }</span>

    /**
     * Constructs a new GHFileBuilder object for a given repository, GitHub instance, and SHA.
     * This constructor is typically used when updating a file, as the SHA of the file is required.
     *
     * @param repository a GHRepository object representing the repository to which the file will be committed.
     * @param github a GitHub object representing the authenticated user's GitHub instance.
     * @param sha a String representing the SHA of the file to be updated.
     */
<span class="fc" id="L60">    public GHFileBuilder(GHRepository repository, Github github, String sha) {</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">        assert repository != null;</span>
<span class="fc" id="L62">        this.repository = repository;</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">        assert github != null;</span>
<span class="fc" id="L64">        this.github = github;</span>
<span class="fc" id="L65">        this.sha = sha;</span>
<span class="fc" id="L66">    }</span>

    /**
     * Constructs a new GHFileBuilder object with all properties set.
     *
     * @param repository a GHRepository object representing the repository to which the file will be committed.
     * @param branch a GHBranch object representing the branch to which the file will be committed.
     * @param path a String representing the path of the file.
     * @param content a String representing the content of the file.
     * @param message a String representing the commit message.
     */
<span class="fc" id="L77">    public GHFileBuilder(GHRepository repository, GHBranch branch, String path, String content, String message, Github github) {</span>
<span class="fc" id="L78">        this.repository = repository;</span>
<span class="fc" id="L79">        this.branch = branch;</span>
<span class="fc" id="L80">        this.path = path;</span>
<span class="fc" id="L81">        this.content = content;</span>
<span class="fc" id="L82">        this.message = message;</span>
<span class="fc" id="L83">        this.github = github;</span>
<span class="fc" id="L84">    }</span>

    /**
     * Sets the branch to which the file will be committed.
     *
     * @param branch a GHBranch object representing the branch to which the file will be committed.
     * @return the current GHFileBuilder object.
     */
    public GHFileBuilder setBranch(GHBranch branch) {
<span class="fc" id="L93">        this.branch = branch;</span>
<span class="fc" id="L94">        return this;</span>
    }

    /**
     * Sets the branch to which the file will be committed.
     *
     * @param branch a String representing the name of the branch to which the file will be committed.
     * @return the current GHFileBuilder object.
     */
    public GHFileBuilder setBranch(String branch) {
<span class="fc" id="L104">        this.branch = repository.getBranches().get(branch);</span>
<span class="fc" id="L105">        return this;</span>
    }

    /**
     * Sets the content of the file.
     *
     * @param content a String representing the content of the file.
     * @return the current GHFileBuilder object.
     */
    public GHFileBuilder setContent(String content) {
<span class="fc" id="L115">        this.content = content;</span>
<span class="fc" id="L116">        return this;</span>
    }

    /**
     * Sets the commit message.
     *
     * @param message a String representing the commit message.
     * @return the current GHFileBuilder object.
     */
    public GHFileBuilder setMessage(String message) {
<span class="fc" id="L126">        this.message = message;</span>
<span class="fc" id="L127">        return this;</span>
    }

    /**
     * Sets the path of the file.
     *
     * @param path a String representing the path of the file.
     * @return the current GHFileBuilder object.
     */
    public GHFileBuilder setPath(String path) {
<span class="fc" id="L137">        this.path = path;</span>
<span class="fc" id="L138">        return this;</span>
    }

    /**
     * Returns the GitHub instance associated with this file builder.
     *
     * @return the GitHub instance
     */
    public Github getGithub() {
<span class="fc" id="L147">        return github;</span>
    }

    /**
     * Returns the repository where this file will be committed.
     *
     * @return the GHRepository instance
     */
    public GHRepository getRepository() {
<span class="fc" id="L156">        return repository;</span>
    }

    /**
     * Returns the branch where this file will be committed.
     *
     * @return the GHBranch instance
     */
    public GHBranch getBranch() {
<span class="fc" id="L165">        return branch;</span>
    }

    /**
     * Returns the content of the file to be committed.
     *
     * @return the content of the file
     */
    public String getContent() {
<span class="fc" id="L174">        return content;</span>
    }

    /**
     * Returns the commit message for the file commit.
     *
     * @return the commit message
     */
    public String getMessage() {
<span class="fc" id="L183">        return message;</span>
    }

    /**
     * Returns the path where the file will be committed.
     *
     * @return the path of the file
     */
    public String getPath() {
<span class="fc" id="L192">        return path;</span>
    }

    /**
     * Commits the file to the repository.
     * This method is not yet implemented.
     */
    public void commit(String email, String name) {
<span class="fc" id="L200">        String url = repository.getUrl() + &quot;/contents/&quot; + path;</span>
<span class="fc" id="L201">        JSONObject jsonObject = new JSONObject();</span>
<span class="fc" id="L202">        jsonObject.put(&quot;message&quot;, message);</span>
<span class="fc" id="L203">        JSONObject committer = new JSONObject();</span>
<span class="fc" id="L204">        committer.put(&quot;name&quot;, name);</span>
<span class="fc" id="L205">        committer.put(&quot;email&quot;, email);</span>
<span class="fc" id="L206">        jsonObject.put(&quot;committer&quot;, committer);</span>
<span class="fc" id="L207">        String encodedString = Base64.getEncoder().encodeToString(content.getBytes());</span>
<span class="fc" id="L208">        jsonObject.put(&quot;content&quot;, encodedString);</span>
<span class="fc bfc" id="L209" title="All 2 branches covered.">        if (sha != null) {</span>
<span class="fc" id="L210">            jsonObject.put(&quot;sha&quot;, sha);</span>
        }
<span class="fc" id="L212">        sendPutRequest(url,github.getToken(), jsonObject);</span>
<span class="fc" id="L213">    }</span>

    /**
     * Commits the file to the repository using the authenticated user's email and login as the committer's details.
     * This method first sends a GET request to retrieve the authenticated user's email.
     * Then, it calls the overloaded commit method with the retrieved email and the authenticated user's login.
     */
    public void commit() {
<span class="fc" id="L221">        String response =  sendGetRequest(getBaseUrl() + &quot;/user/email&quot;, github.getToken());</span>
<span class="fc bfc" id="L222" title="All 2 branches covered.">        if (response == null) {</span>
<span class="fc" id="L223">            response = new JSONObject().put(&quot;email&quot;, &quot;example@example.com&quot;).toString();</span>
        }
<span class="fc" id="L225">        JSONObject jsonObject = new JSONObject(response);</span>
<span class="fc" id="L226">        commit(jsonObject.getString(&quot;email&quot;), github.getSelfUser().getLogin());</span>
<span class="fc" id="L227">    }</span>

    /**
     * Returns the SHA of the file to be committed.
     * The SHA is used when updating a file, as it is required to identify the file in the repository.
     *
     * @return the SHA of the file
     */
    public String getSha() {
<span class="fc" id="L236">        return sha;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>
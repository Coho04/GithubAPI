package de.coho04.githubapi.entities;

import de.coho04.githubapi.Github;
import de.coho04.githubapi.bases.GHBase;
import org.json.JSONObject;

/**
 * This class represents a GitHub Vulnerability.
 * It provides methods for fetching data about the vulnerability such as its package, first patched version, vulnerable version range, and vulnerable functions.
 */
@SuppressWarnings("unused")
public class GHVulnerability extends GHBase {

    private final GHPackage ghPackage;
    private final String firstPatchedVersion;
    private final String vulnerableVersionRange;
    private final String[] vulnerableFunctions;

    /**
     * Constructs a new GHVulnerability instance with the provided JSON object.
     *
     * @param jsonObject the JSON object containing the vulnerability data
     */
    public GHVulnerability(Github github, JSONObject jsonObject) {
        this.ghPackage = new GHPackage(github, jsonObject.getJSONObject("package"));
        this.firstPatchedVersion = getStringOrNull(jsonObject, "first_patched_version");
        this.vulnerableVersionRange = getStringOrNull(jsonObject, "vulnerable_version_range");
        this.vulnerableFunctions = getArrayOrNull(jsonObject, "vulnerable_functions", JSONObject::toString).toArray(new String[0]);
    }

    /**
     * Returns the package of the vulnerability.
     *
     * @return the package of the vulnerability
     */
    public GHPackage getGhPackage() {
        return ghPackage;
    }

    /**
     * Returns the first patched version of the vulnerability.
     *
     * @return the first patched version of the vulnerability
     */
    public String getFirstPatchedVersion() {
        return firstPatchedVersion;
    }

    /**
     * Returns the vulnerable version range of the vulnerability.
     *
     * @return the vulnerable version range of the vulnerability
     */
    public String getVulnerableVersionRange() {
        return vulnerableVersionRange;
    }

    /**
     * Returns the vulnerable functions of the vulnerability.
     *
     * @return the vulnerable functions of the vulnerability
     */
    public String[] getVulnerableFunctions() {
        return vulnerableFunctions;
    }
}